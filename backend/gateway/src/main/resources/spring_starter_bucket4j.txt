bucket4j:
  enabled: true
  cache-to-use: redis
  default-http-content-type: application/json
  default-http-status-code: TOO_MANY_REQUESTS
  default-http-response-body: "{ \"message\": \"Too many requests!\" }"
  filters:
    - cache-name: buckets
      filter-method: gateway
      url: /api/.*
      strategy: all
      rate-limits:
        # ANONYMOUS USERS
        - cache-key: "@subscriptionPlanResolver.resolveKey(#request)"
          skip-condition: "!('ANONYMOUS'.equals(@subscriptionPlanResolver.resolvePlan(#request)))"
          bandwidths:
            - capacity: 20
              time: 1
              unit: minutes

        # FREE TIER USERS
        - cache-key: "@subscriptionPlanResolver.resolveKey(#request)"
          skip-condition: "!('FREE'.equals(@subscriptionPlanResolver.resolvePlan(#request)))"
          bandwidths:
            - capacity: 100
              time: 1
              unit: hours
            - capacity: 30
              time: 1
              unit: minutes

        # PREMIUM TIER USERS
        - cache-key: "@subscriptionPlanResolver.resolveKey(#request)"
          skip-condition: "!('PREMIUM'.equals(@subscriptionPlanResolver.resolvePlan(#request)))"
          bandwidths:
            - capacity: 5000
              time: 1
              unit: hours
            - capacity: 200
              time: 1
              unit: minutes@