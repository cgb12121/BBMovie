spring.application.name=transcode-worker
server.port=9696

spring.threads.virtual.enabled=true

minio.url=${MINIO_API_URL}
minio.access-key=${MINIO_ACCESS_KEY}
minio.secret-key=${MINIO_SECRET_KEY}

# MinIO Buckets
# bbmovie-raw    -> raw uploaded files (source videos/images)
# bbmovie-hls    -> HLS segments after transcoding
# bbmovie-secure -> encryption keys for HLS
# bbmovie-public -> processed images (avatars, posters, etc.)
app.minio.raw-bucket=${MINIO_RAW_BUCKET}
app.minio.hls-bucket=${MINIO_HLS_BUCKET}
app.minio.secure-bucket=${MINIO_SECURE_BUCKET}
app.minio.public-bucket=${MINIO_PUBLIC_BUCKET}
app.minio.public-hls-url=${minio.url}/${MINIO_HLS_BUCKET}/movies

ffmpeg.path=${FFMPEG_PATH}
ffprobe.path=${FFPROBE_PATH}

app.transcode.temp-dir=${TEMP_DIR}
logging.level.com.bbmovie=DEBUG
app.clamav.enabled=${CLAMAV_ENABLED:true}
app.transcode.key-server-url=${STREAM_API}
logging.level.net.bramp.ffmpeg.progress=ERROR

# Transcode Scheduler Configuration
# Auto-detects CPU cores and reserves some for OS/DB
# Set to 0 for auto-detection, or override with specific value
# Auto-detection: For systems > 4 cores, reserves 2 cores for OS/DB
#                 For systems <= 4 cores, uses all cores (budget VPS)
app.transcode.max-capacity=0

# NATS JetStream Configuration
# Subject to subscribe to for MinIO events
nats.minio.subject=${NATS_MINIO_SUBJECT}
# JetStream stream name
nats.stream.name=${NATS_STREAM_NAME}
# Consumer durable name (unique per worker instance)
nats.consumer.durable=transcode-worker
# Ack wait duration in minutes (how long to wait before redelivery)
nats.consumer.ack-wait-minutes=5
# Heartbeat interval in seconds (send inProgress() every N seconds)
nats.consumer.heartbeat-interval-seconds=30
# Batch size for fetching messages (should be <= maxCapacity)
nats.consumer.fetch-batch-size=5
# Fetch timeout in seconds (how long to wait for messages)
nats.consumer.fetch-timeout-seconds=2
# Status update subject
nats.status.subject=${NATS_STATUS_SUBJECT}

# ========================================
# 3-Stage Pipeline Configuration
# ========================================
# Enable the new 3-stage pipeline (set to true to use instead of MediaEventConsumer)
app.pipeline.enabled=true

# Queue capacities
app.pipeline.probe-queue-capacity=100
app.pipeline.execute-queue-capacity=50

# Thread counts
app.pipeline.prober-thread-count=5
app.pipeline.executor-thread-count=4

# Timeouts
app.pipeline.resource-acquire-timeout-seconds=10
app.pipeline.probe-queue-poll-timeout-ms=500
app.pipeline.execute-queue-poll-timeout-ms=500
app.pipeline.monitor-interval-seconds=30

# Probe strategies
app.probe.timeout-seconds=30
app.probe.partial-size-mb=10

# MinIO presigned URL expiry
app.minio.presigned-url-expiry-minutes=60